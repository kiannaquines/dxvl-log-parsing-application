{% extends "./includes/base.html" %}
{% load static %}
{% block title %}University DXVL Dashboard{% endblock title %}

{% block page_css %}
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css">
    <style>
        .dropzone {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 5px;
            border: 2px dashed #95A2AF;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 5px; 
        }
       
        .dropzone .dz-preview {
            height: 100%;
        }

        .dz-message {
            display: block;
        }

        .dz-message .note {
            font-size: 18px;
        }

        .dz-message h3{
            font-size: 30px;
        }
    </style>
{% endblock page_css %}

{% block content %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <h5 class="card-header">Upload Multiple Log Files</h5>
                <div class="card-body">
                    <form enctype="multipart/form-data" action="{% url 'parse_logs_view' %}" class="dropzone" id="dropzone-multi">
                    {% csrf_token %}
                        <div class="dz-message">
                            <img
                                src="{% static 'assets/img/upload.svg' %}"
                                alt="Upload Log Files"
                                width="270"
                                height="270"
                            >
                            <h3>Drop files here or click to upload</h3>
                            <span class="note">Selected your files and click the upload button.</span>
                        </div>
                        <div class="fallback">
                            <input name="file" type="file" style="visibility: hidden;">
                        </div>
                    </form>
                    <button type="submit" class="btn btn-primary btn-lg mt-3">Upload Logs</button>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}


{% block page_js %}
    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <script src="{% static 'assets/js/dashboards-analytics.js' %}"></script>
    <script>
        Dropzone.options.dropzoneMulti = {
            paramName: "files",
            maxFilesize: 5,
            autoProcessQueue: false,
            uploadMultiple: true,
            parallelUploads: 25,
            maxFiles: 25,
            acceptedFiles: ".txt",
            init: function() {
                var myDropzone = this;

                var submitButton = document.querySelector("button[type=submit]");

                if (submitButton) {
                    submitButton.addEventListener("click", function(e) {
                        e.preventDefault();
                        myDropzone.processQueue();
                    });
                }

                this.on("addedfile", function(file) {
                    // alert(`File: ${file.name}, is added`);
                });

                this.on("success", function(file, response) {
                    console.log("File uploaded successfully!");
                });

                this.on("complete", function(file) {
                    myDropzone.removeFile(file);
                });

                this.on("error", function(file, errorMessage, xhr) {
                    // alert(`Error: ${errorMessage}`);
                });
            }
        };
    </script>
{% endblock page_js %}
